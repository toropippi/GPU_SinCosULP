# GPU Sin/Cos ULP誤差 全探索調査ツール

## 概要

このプロジェクトは、GPU上で実行される `native_sin` および `native_cos` 関数の単精度浮動小数点 (32-bit float) におけるULP (Units in the Last Place) 誤差を測定するためのツール群の1つです。  
GPUにはSFUを代表とした高速近似ハードウェアが実装されており、1clockで計算できる反面精度が少し劣ります。OpenCLのnative_xx系命令がSFUに対応します。  
native_sinとnative_cosに対比して普通のsin cos(高精度版)も単精度で計算して保存していますが、実はこのsin cosも2ULPまで誤差がある可能性があります。本当の値はdoubleで計算しfloatにキャストする必要があります。  

このプログラムの最大の特徴は、`0x00000000` から `0xFFFFFFFF` までの32ビット浮動小数点数の全パターン (約42億) を入力値として与え、誤差を網羅的に探索する点にあります。  

## 動作の仕組み

1.  **`sincos誤差調査.hsp` (HSPスクリプト)**
    *   メインの制御アプリケーションです。
    *   32ビットの全パターンを生成し、OpenCLカーネルに渡す準備をします。
    *   `HSPCL64.dll` を介してGPUと通信します。

2.  **`SinCosX.cl` (OpenCLカーネル)**
    *   GPU上で並列実行されるカーネルコードです。
    *   HSPから渡された32ビット整数を `as_float()` 関数を用いて浮動小数点数として解釈します。
    *   解釈した浮動小数点数に対して `sin()` および `cos()` の計算を実行します。
    *   計算結果をメインアプリケーションに返します。

3.  **誤差測定**
    *   メインアプリケーション側で、GPUからの計算結果と、より高精度なリファレンス値とを比較し、ULP誤差を算出・記録します。

## ファイル構成

-   `sincos誤差調査.hsp`: メインプログラムのソースコードです (HSP)。
-   `sincos誤差調査.exe`: コンパイル済みの実行ファイルです。
-   `SinCosX.cl`: GPUで実行されるOpenCLカーネルコードです。`sin`と`cos`の計算を行います。
-   `HSPCL64.dll` / `HSPCL64.as`: HSPからOpenCLを呼び出すためのライブラリおよび関連ファイルです。
-   `README.md`: このファイルです。

## 実行方法

OpenCLが利用可能なGPU環境で `sincos誤差調査.exe` を実行してください。

**注意:** ファイル書き込みに長い時間がかかります。64GB消費します。
